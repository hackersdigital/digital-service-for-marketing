{% extends "base.html" %}
{% block title %}{{ form_cfg.name }} • Digital Service{% endblock %}
{% block content %}
<a href="/" class="inline-flex items-center text-sm text-gray-600 hover:text-brand-700 mb-6">← Back to forms</a>

<div class="bg-white rounded-2xl border border-gray-200 p-6">
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-xl md:text-2xl font-semibold">{{ form_cfg.name }}</h1>
      <p class="text-sm text-gray-600 mt-1">Client: <span class="font-medium">{{ form_cfg.client_slug }}</span></p>
    </div>
    <span class="text-[10px] px-2 py-1 rounded-full bg-gray-100 text-gray-600 uppercase tracking-wide h-fit">
      {{ form_cfg.form_slug }}
    </span>
  </div>

  <form method="post" action="/f/{{ form_cfg.client_slug }}/{{ form_cfg.form_slug }}/submit" class="mt-6 space-y-8">
    <input type="hidden" name="_agent_token" value="21O9MnU89WKX3XkIU8oeZdKBk" />

    <!-- Primary fields -->
    <section>
      <h2 class="text-base font-semibold mb-4">Primary Details</h2>
      <div class="grid md:grid-cols-2 gap-4">
        {% for field in form_cfg.ui.fields %}
          {% set is_required = field.required|default(false) %}
          {% set ftype = field.type|default('text') %}
          {% set placeholder = field.placeholder|default('') %}
          {% set is_additional = field.additional|default(false) %}

          {% if not is_additional %}
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {{ field.label }}
              {% if is_required %}
                <span class="ml-1 text-[10px] px-1.5 py-0.5 rounded bg-brand-600 text-white align-middle">Required</span>
              {% endif %}
            </label>
            <input
              name="{{ field.name }}"
              type="{{ ftype }}"
              {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
              {% if is_required %}required{% endif %}
              class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-600"
            />
            {% if field.help %}
              <p class="mt-1 text-xs text-gray-500">{{ field.help }}</p>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
      </div>
    </section>

    <!-- Additional details (collapsible) -->
    <section x-data="{open:false}">
      <div class="flex items-center justify-between">
        <h2 class="text-base font-semibold">Additional Details</h2>
        <button type="button" onclick="document.getElementById('extra').classList.toggle('hidden')"
                class="text-sm text-brand-700 hover:underline">Toggle</button>
      </div>
      <div id="extra" class="mt-4 hidden">
        <div class="grid md:grid-cols-2 gap-4">
          {% for field in form_cfg.ui.fields %}
            {% set is_required = field.required|default(false) %}
            {% set ftype = field.type|default('text') %}
            {% set placeholder = field.placeholder|default('') %}
            {% set is_additional = field.additional|default(false) %}

            {% if is_additional %}
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                {{ field.label }}
                {% if is_required %}
                  <span class="ml-1 text-[10px] px-1.5 py-0.5 rounded bg-brand-600 text-white align-middle">Required</span>
                {% endif %}
              </label>
              <input
                name="{{ field.name }}"
                type="{{ ftype }}"
                {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
                {% if is_required %}required{% endif %}
                class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-600"
              />
              {% if field.help %}
                <p class="mt-1 text-xs text-gray-500">{{ field.help }}</p>
              {% endif %}
            </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </section>

    <div class="flex items-center justify-between">
      <p class="text-xs text-gray-500">All submissions are logged and forwarded to the configured client endpoint.</p>
      <button type="submit"
              class="inline-flex items-center justify-center rounded-lg bg-brand-600 text-white px-5 py-2.5 font-medium hover:bg-brand-700 transition">
        Submit Form
      </button>
    </div>
  </form>
</div>

<!-- Minimal helpers for phone & DOB formatting -->
<script>
  // Auto-format phone like (XXX) XXX-XXXX (non-destructive)
  document.querySelectorAll('input[name="number1"], input[name="alt_phone"]').forEach(inp=>{
    inp.addEventListener('input', e=>{
      let v = e.target.value.replace(/\D/g,'').slice(0,10);
      let out = v;
      if (v.length > 6) out = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6)}`;
      else if (v.length > 3) out = `(${v.slice(0,3)}) ${v.slice(3)}`;
      e.target.value = out;
    });
  });

  // Soft mask MM/DD/YYYY
  const dob = document.querySelector('input[name="date_of_birth"]');
  if (dob) {
    dob.addEventListener('input', e=>{
      let v = e.target.value.replace(/\D/g,'').slice(0,8);
      if (v.length >= 5) e.target.value = `${v.slice(0,2)}/${v.slice(2,4)}/${v.slice(4)}`;
      else if (v.length >= 3) e.target.value = `${v.slice(0,2)}/${v.slice(2)}`;
      else e.target.value = v;
    });
  }
</script>
{% endblock %}
